#:kivy 1.4

<Label>:
    font_name: 'ui/fonts/Gotham-Book.ttf'
    font_size: '22dp'
    text_size: self.width-self.padding_x, self.height-self.padding_y
    padding: ('50dp', '5dp')
    valign: 'middle'
    halign: 'center'
    line_height: 1.3


<StatusBar>:
    size: 2048, 150
    y: 1536 - (150*self.alpha_show)
    size_hint: None, None

    canvas:
        Color:
            rgba: 1,1,1,1
        Rectangle:
            pos: 0,0
            size: self.size
            source: "ui/images/statusbarbg.png"

    Label:
        text: "Question: {0}/5".format(root.questions_left)
        size: 2048, 150
        halign: 'left'
        size_hint: None, None
        text_size: 2000, 150
        color: 0,0,0,0.8

    Label:
        text: "Score: {0}".format(root.score)
        halign: 'right'
        size: 2048, 150
        size_hint: None, None
        text_size: 2000, 150
        color: 0,0,0,0.8


<Screen>:
    canvas:
        Color:
            rgba: 0,0,0,1
        Rectangle:
            pos: self.pos
            size: self.size
        Color:
            rgba: 1,1,1,1
        Rectangle:
            pos: self.pos
            size: self.size
            source: 'ui/images/bg.png'



<IntroScreen>:
    canvas:
        Color:
            rgba: 1,1,1,1
        Rectangle:
            pos: self.pos
            size: self.size
            source: 'ui/screens/intro/bg.png'

    BoxLayout:
        size: '400dp', '250dp'
        size_hint: None, None
        center: root.center_x, root.center_y - dp(100)
        orientation: 'vertical'

        Button:
            background_normal: 'ui/screens/intro/btn.png'
            background_down: 'ui/screens/intro/btn_down.png'
            on_release: app.start_quiz()

        Button:
            background_normal: 'ui/screens/intro/viewstandings_btn.png'
            background_down: 'ui/screens/intro/viewstandings_btn_down.png'
            on_release: app.start_viewstandings()



<QuestionScreen>:
    canvas:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
            source: 'ui/screens/question/bg.png'

    on_reset: [x.reset() for x in (opt1, opt2, opt3, opt4)]

    BoxLayout:
        orientation: 'vertical'

        Label:
            text: root.text
            markup: True
            font_name: 'ui/fonts/Gotham-Bold.ttf'
            font_size: '28dp'
            halign: 'left'
            size_hint: None, 1
            width: root.width - 250

        GridLayout:
            on_parent: root.button_grid = self
            cols: 2
            padding: '20dp'
            spacing: '20dp'

            QuestionButton:
                id: opt1
                text: root.option_a
                on_release: app.check_answer(root, self, 1)
            QuestionButton:
                id: opt2
                text: root.option_b
                on_release: app.check_answer(root, self, 2)
            QuestionButton:
                id: opt3
                text: root.option_c
                on_release: app.check_answer(root, self, 3)
            QuestionButton:
                id: opt4
                text: root.option_d
                on_release: app.check_answer(root, self, 4)


<QuestionButton>:
    font_name: 'ui/fonts/Gotham-Bold.ttf' if self.alpha_rotation < 0.5 else 'ui/fonts/Gotham-Book.ttf'
    halign: 'center' if self.alpha_rotation < 0.5 else 'left'
    font_size: '22dp' if self.alpha_rotation < 0.5 else '14dp'
    background_normal: "ui/screens/question/qbg.png"
    background_down: "ui/screens/question/qbg_down.png"
    background_wrong: "ui/screens/question/qbg_wrong.png"


<AnswerScreen>:
    canvas:
        Color:
            rgba: 1,1,1,1
        Rectangle:
            pos: self.pos
            size: self.size
            source: 'ui/screens/answer/bg.png'

    BoxLayout:
        orientation: 'vertical'
        Widget:
            size_hint_y: None
            height: 150
        Label:
            font_name: 'ui/fonts/Gotham-Bold.ttf'
            font_size: '76dp'
            height: '100dp'
            halign: 'left'
            valign: 'bottom'
            size_hint_y: None
            text: root.feedback
        Label:
            halign: 'left'
            font_size: '24dp'
            valign: 'top'
            text: root.text+"\n"
        Widget:
            size_hint_y: None
            height: 500



    ScrollView:
        do_scroll_y: False
        size_hint: 1, None
        height: 500

        canvas.before:
            Color:
                rgba: 1,0,0,0.0
            Rectangle:
                pos: self.pos
                size: self.size

        ThumnailList:
            padding: 50
            spacing: 50
            size_hint: None, None
            height: 500
            minimum_width: self.width
            on_parent: root.image_layout = self


    Button:
        on_release: app.next_question()
        background_normal: "ui/screens/answer/nextbtn.png"
        background_down: "ui/screens/answer/nextbtn_down.png"
        size_hint: None, None
        size: 200,200
        right: root.right - 50
        y: 50




<ResultsScreen>:
    fadelist_1: [title, score_text]
    fadelist_2: [title, score_text, cityinput, citylabel]
    canvas:
        Color:
            rgba: 1,1,1,1
        Rectangle:
            pos: self.pos
            size: self.size
            source: 'ui/screens/results/bg.png'

    Label:
        id: title
        size_hint: 1, None
        text: "Nice work, friend."
        height: '100dp'
        top: root.top - dp(10)
        valign: 'bottom'
        halign: 'left'
        font_name: 'ui/fonts/Gotham-Bold.ttf'
        font_size: '100dp'


    Label:
        id: score_text
        text: root.text
        size_hint: 1, None
        height: '100dp'
        top: title.y - dp(10)
        valign: 'top'
        halign: 'left'
        font_size: '65dp'
        font_name: 'ui/fonts/Gotham-Book.ttf'


    GridLayout:
        cols: 2
        size_hint: 1, None
        height: '250dp'
        top: score_text.y + dp(20)
        padding: dp(50)
        Label:
		    id: citylabel
            text: "Where are you from?"
            font_size: '36dp'
            halign: 'left'
            padding: 0,0
        Label:
            id: nicklabel
            text: "What's your name?"
            font_size: '36dp'
            halign: 'left'
            padding: 0,0

        CustomTextInput:
            id: cityinput
            text: ""
            on__keyboard: root.fadein(root.fadelist_1) if self._keyboard else root.fadeout(root.fadelist_1)
            autocomplete_source: 'ui/uscities.json'
            autocomplete_placeholder: city_placeholder
            autocomplete_hidelist: [nickinput, nicklabel]

        FloatLayout:
            # mimic the height of the cityinput
            id: fl
            size_hint_y: None
            height: cityinput.height

            BoxLayout:
                id: city_placeholder
                pos: fl.pos
                orientation: 'vertical'

            CustomTextInput:
                id: nickinput
                pos: fl.pos
                text: ""
				on__keyboard: root.fadein(root.fadelist_2) if self._keyboard else root.fadeout(root.fadelist_2)


    Button:
        id: submit_btn
		background_color: (1, 0, 0, 1)
        background_down: 'ui/screens/results/submit_down.png'
        background_normal: 'ui/screens/results/submit.png'
		on_release: app.submit_score(nickinput, cityinput) if (nickinput.is_valid and cityinput.is_valid) else None
		opacity: 1 if (nickinput.is_valid and cityinput.is_valid) else 0
        right: root.right - dp(50)
        size: dp(320), dp(100)
        size_hint: None, None
        y: '150dp'

    Button:
		background_color: (0, 1, 0, 1)
        background_down: 'ui/screens/results/nosubmit_down.png'
        background_normal: 'ui/screens/results/nosubmit.png'
        on_release: app.screen_manager.current = 'intro'
        right: submit_btn.right
        size: dp(320), dp(100)
        size_hint: None, None
        text: "Don't submit score - start over."
        top: submit_btn.y - dp(20)


<ProgressionView>:
    auto_dismiss: False
    background: 'ui/screens/loading/loading-logo.png'
    border: (0, 0, 0, 0)

    AnchorLayout:

        BoxLayout:
            size_hint: None, None
            size: ('400dp', '250dp')
            orientation: 'vertical'
            padding: '50dp'
            Label:
                text: root.text
            ProgressBar:
                value: root.progression

<AnswerImage>:
    mipmap: True
    allow_stretch: True

<AnswerImagePopup>:
    scatter: scatter
    background_color: (0, 0, 0, 1.0)
    background: 'ui/screens/answer/imageviewbg.png'

    ScatterPlane:
        id: scatter
        opacity: root.alpha
        scale_min: 1.0
        on_center_x: self.center_x = min(max(0,self.center_x), root.height)
        on_center_y: self.center_y = min(max(0,self.center_y), root.height)
        AsyncImage:
            mipmap: True
            source: root.answer.img_data['full']
            # for positionning, take care of the label
            size: root.width - dp(100), root.height - dp(150)
            pos: dp(50), dp(100)

    FloatLayout:
        Image:
            size: 150,150
            x: root.width - self.width - 20
            y: root.height - self.height - 20
            source: "ui/screens/answer/imageviewclose.png"
            size_hint: None, None
            on_touch_down: root.dismiss() if self.collide_point(*args[1].pos) else None

        Label:
            text: root.answer.text or ''
            size_hint_y: None
            height: '50dp'
            font_size: '12dp'
            y: -(1 - root.alpha) * self.height
            on_touch_down: root.dismiss() if self.collide_point(*args[1].pos) else None

            canvas.before:
                Color:
                    rgba: .05, .05, .05, .9
                Rectangle:
                    pos: self.pos
                    size: self.size

<CustomTextInput>:
    text: self.rawtext + ('|' if self._keyboard else '')
    font_size: '30sp'
    height: img.texture_size[1]
    size_hint_y: None

    Image:
        id: img
		color: root.color
        pos: root.pos
        size: root.size
        source: 'ui/screens/results/input_bg.png'
        height: self.texture_size[1]
        allow_stretch: True

<CompletionLabel>:
    font_size: '18sp'

<CompletionButton>:
    background_color: 0, 0, 0, 0


<StandingsScreen>:
	container: container
    canvas:
        Color:
            rgba: 1,1,1,1
        Rectangle:
            pos: self.pos
            size: self.size
            source: 'ui/screens/standings/bg.png'

    Label:
        id: title
        size_hint: 1, None
        text: 'Standings'
        height: '100dp'
        top: root.top - dp(10)
        valign: 'bottom'
        halign: 'left'
        font_name: 'ui/fonts/Gotham-Bold.ttf'
        font_size: '80dp'

	Button:
		top: root.top - dp(10)
		right: root.right - dp(20)
        size: dp(225), dp(100)
		size_hint: None, None
		border: 0, 0, 0, 0
		background_normal: 'ui/screens/standings/returnbtn.png'
		background_down: 'ui/screens/standings/returnbtn_down.png'
		on_release: app.screen_manager.current = 'intro'


	GridLayout:
		height: '50dp'
		size_hint: 1, None
		rows: 1
        top: title.y - dp(5)


		Label:
			text: 'view by:'
			size_hint_x: None
			width: '150sp'
			font_size: '22sp'

		Button:
			text: 'NICK'
			background_color: (0, 0, 0, 0)
			on_release: root.tp = 'nick'
			font_name: 'ui/fonts/Gotham-{0}.ttf'.format('Bold' if root.tp == 'nick' else 'Book')

		Button:
			text: 'CITY'
			background_color: (0, 0, 0, 0)
			on_release: root.tp = 'city'
			font_name: 'ui/fonts/Gotham-{0}.ttf'.format('Bold' if root.tp == 'city' else 'Book')

		Button:
			text: 'COUNTY'
			background_color: (0, 0, 0, 0)
			on_release: root.tp = 'county'
			font_name: 'ui/fonts/Gotham-{0}.ttf'.format('Bold' if root.tp == 'county' else 'Book')

		Button:
			text: 'STATE'
			background_color: (0, 0, 0, 0)
			on_release: root.tp = 'state'
			font_name: 'ui/fonts/Gotham-{0}.ttf'.format('Bold' if root.tp == 'state' else 'Book')

	BoxLayout:
		id: container
		size_hint: None, None
		size: root.width - dp(100), root.height - dp(250)
		pos: root.x + dp(50), root.y + dp(50)

<NickStandingEntry>:
	Label:
		text: root.entry.get('nick', '')
		font_name: 'ui/fonts/Gotham-Bold.ttf'
		halign: 'left'
		size_hint_x: None
		width: '150dp'
	Label:
		text: root.entry.get('city', '')
		halign: 'left'
	Label:
		text: root.entry.get('county', '')
		halign: 'left'
	Label:
		text: root.entry.get('state_code', '')
		size_hint_x: None
		width: '100dp'
		halign: 'left'
	Label:
		text: root.entry.get('score', '')
		size_hint_x: None
		width: '120dp'
		halign: 'center'

<CityStandingEntry>:
	Label:
		text: root.entry.get('city', '')
		font_name: 'ui/fonts/Gotham-Bold.ttf'
		halign: 'left'
	Label:
		text: root.entry.get('county', '')
		halign: 'left'
	Label:
		text: root.entry.get('state_code', '')
		size_hint_x: None
		width: '100dp'
		halign: 'left'
	Label:
		text: root.entry.get('score', '')
		size_hint_x: None
		width: '120dp'
		halign: 'center'

<CountyStandingEntry>:
	Label:
		text: root.entry.get('county', '')
		font_name: 'ui/fonts/Gotham-Bold.ttf'
		halign: 'left'
	Label:
		text: root.entry.get('state_code', '')
		size_hint_x: None
		width: '100dp'
		halign: 'left'
	Label:
		text: root.entry.get('score', '')
		size_hint_x: None
		width: '120dp'
		halign: 'center'

<StateStandingEntry>:
	Label:
		text: root.entry.get('state', '')
		font_name: 'ui/fonts/Gotham-Bold.ttf'
		halign: 'left'
	Label:
		text: root.entry.get('score', '')
		size_hint_x: None
		width: '120dp'
		halign: 'center'
